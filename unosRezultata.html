<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.js"></script>
    <style media="screen">
      td, tr {border: 1px solid green;}
      td { width: 50px; height: 50px; border-collapse: separate; font-size: 30px;}
    </style>
  </head>
  <body>
    Ime studenta: <input type="text" id="ime_r" />
    <br />
    Prezime studenta: <input type="text" id="prezime_r" />
    <br />
    <button id="btn_tablica">Dohvati tablicu</button>
    <p id="tbl"></p>
    <p id="btn_spremi"></p>
    <script type="text/javascript">
      var i = null, p = null, id_studenta = null;
      var elt = null, id_kolegija = null, duljina_id_kolegija;
      var popis_kolegija = [];
      console.log("Na stranici unesiRezultate.html");
      //polje za podatke koji se nalaze u prvom retku tablice sa rezultatima
      var td_kategorije = ["Kolegij", "1.kolokvij", "2.kolokvij", "Završni ispit", "1.zadaća", "2.zadaća", "3.zadaća", "4.zadaća"];
      var td_kategorije_db = ["Kolegij", "1kolokvij", "2kolokvij", "zavrsni", "1zadaca", "2zadaca", "3zadaca", "4zadaca"];
      /*console.log(username);
      console.log(pass);
      console.log(ime);
      console.log(prezime)
      console.log(id);*/

      $(document).ready(function(){
        $("#btn_tablica").on("click", ispisTablice);
      });
      function ispisTablice() {
        i = $("#ime_r").val();
        p = $("#prezime_r").val();
        console.log(i);
        console.log(p);
        $("#btn").prop("display", "none");
        $.ajax({
          url: "unosRezultata.php",
          data:
          {
            i: i,
            p: p
          },
          dataType: "json",
          success: function(data) {
            console.log(data.info);
            console.log(data.id);
            id_studenta = data.id;
            for(var i = 0; i < data.kolegiji.length; i++)
              popis_kolegija.push(data.kolegiji[i].ime);
            if(!data.potvrda) {
              alert("Korisnik ne postoji! Unesi točne podatke.");
              $("#ime_r").val("");
              $("#prezime_r").val("");
            }
            ispisRezultata(data.rez);
          },
          error : function(xhr, status) {
            if(status !== "null")
            console.log("Nesto nije u redu s Ajax upitom. Status: " + status + ".");
          }
        });
      }
      //fja za dinamičko stvaranje tablice sa rezultatima
      function ispisRezultata(data) {
        console.log("U fji ispisRezultata");
        var tbl = $("<table></table>");
        //prvi redak tablice
        var tr = $("<tr></tr>");
        //potrebno je 8 ćelija sa nazivima elemenata za ocjenjivanje
        for(var k = 0; k < 8 ; k++) {
          var td = $("<td><</td>");
          td.prop("align", "center").css("color", "green").html(td_kategorije[k]);
          tr.append(td);
        }
        tbl.append(tr);
        //kreiranje jednog retka za svaki kolegij koji je korisnik upisao
        //kreiranje ćelija u koje se upisuju bodovi iz određenog elementa
        for(var i = 0; i < data.length; i++) {
          var td_podrucja = [data[i].ime, data[i].kol1, data[i].kol2, data[i].zavrsni, data[i].dz1, data[i].dz2, data[i].dz3, data[i].dz4];
          var tr = $("<tr></tr>");
          for(var j = 0; j < 8; j++) {
            var td = $("<td></td>");
            if(td_podrucja[j] === null) {
              var input = $("<input />");
              for(var k = 0; k < popis_kolegija.length; k++) {
                if(data[i].ime === popis_kolegija[k]) {
                  var z = 0;
                  z = k+1;
                  input.prop("type", "text").prop("class", "rez").prop("id", "k"+z+"e"+j).prop("align", "center");
                }
              }
              td.append(input);
            }
            else
              td.prop("align", "center").css("color", "green").html(td_podrucja[j]);
            tr.append(td);
          }
          tbl.append(tr);
        }
        $("#tbl").html(tbl);
        var btn = $("<button></button>");
        btn.prop("class", "spremi").html("Spremi");
        $("#btn_spremi").append(btn);
        console.log("Nacrtao tablicu, izlazim iz fje.");
      }
      $("body").on("click", "button.spremi", function(){
        window.location.href = "administrator.html";
      });
      $("body").on("change", "input.rez", spremiRezultat);
      function spremiRezultat() {
        var id = $(this).prop("id");
        id_elta = $(this).prop("id")[id.length-1];
        duljina_id_kolegija = id.length - 3;
        elt = td_kategorije_db[id_elta];
        id_kolegija = id.slice(1, duljina_id_kolegija+1);
        var bodovi = $(this).val();
        $.ajax({
          url: "unosRezultata.php",
          data:
          {
            id_studenta: id_studenta,
            id_kolegija: id_kolegija,
            elt: elt,
            bodovi: bodovi
          },
          dataType: "json",
          success: function(data) {
            console.log(data.info);
          },
          error : function(xhr, status) {
            if(status !== "null")
            console.log("Nesto nije u redu s Ajax upitom. Status: " + status + ".");
          }
        });
      }
    </script>

  </body>
</html>

